<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - OnboardX</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/css/admin_dashboard.css">
    <link rel="stylesheet" href="/css/document-viewer.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Sortable.js for drag and drop functionality -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <!-- Include API client -->
    <script src="/js/api.js"></script>
    <style>
        /* Hide notification feed */
        .notification-feed, #notification-feed {
            display: none !important;
        }

        /* Task Management Styles */
        .task-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .task-column {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
        }

        .task-column h3 {
            color: #fff;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-count {
            background: #444;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.9em;
        }

        .task-list {
            min-height: 200px;
        }

        .task-card {
            background: #333;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: move;
        }

        .task-card:hover {
            background: #3a3a3a;
        }

        .task-card h4 {
            color: #fff;
            margin: 0 0 8px 0;
        }

        .task-card p {
            color: #aaa;
            font-size: 0.9em;
            margin: 0;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            font-size: 0.8em;
            color: #888;
        }

        .priority-high { color: #ff4444; }
        .priority-medium { color: #ffbb33; }
        .priority-low { color: #00C851; }

        .search-add {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #task-search {
            flex: 1;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #444;
            background: #333;
            color: #fff;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        .modal-content {
            background: #2a2a2a;
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
            border-radius: 8px;
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #fff;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #444;
            background: #333;
            color: #fff;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Dashboard-specific styles */
        .dashboard-section-container {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .view-all-link {
            color: #4CAF50;
            text-decoration: none;
            font-size: 0.9em;
        }
        
        .view-all-link:hover {
            text-decoration: underline;
        }
        
        .task-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        
        .task-summary-item {
            background: #333;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }
        
        .task-summary-label {
            color: #aaa;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .task-summary-value {
            color: #fff;
            font-size: 1.6em;
            font-weight: 500;
        }
        
        .progress-bar {
            background: #444;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 4px;
        }
        
        .progress {
            background: #4CAF50;
            height: 100%;
        }
        
        .progress-text {
            font-size: 0.8em;
            color: #aaa;
        }
        
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .status-badge.active {
            background: #4CAF50;
            color: white;
        }
        
        .status-badge.success {
            background: #00C851;
            color: white;
        }
        
        .status-badge.warning {
            background: #ffbb33;
            color: black;
        }
        
        .status-badge.secondary {
            background: #7d7d7d;
            color: white;
        }
        
        .status-badge.default {
            background: #555;
            color: white;
        }
        
        .loading-indicator {
            text-align: center;
            padding: 20px;
            color: #aaa;
        }
        
        .loading-indicator i {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .empty-state, .error-state {
            text-align: center;
            padding: 20px;
            color: #aaa;
            font-style: italic;
        }
        
        .error-state {
            color: #ff4444;
        }
        
        .text-center {
            text-align: center;
        }

        /* Additional CSS for the chart */
        .chart-container {
            background-color: #222;
            border-radius: 8px;
            padding: 20px;
            margin-top: 10px;
            height: 300px;
            position: relative;
        }

        /* Add chart container for better visibility */
        #taskStatusChart {
            width: 100%;
            max-height: 100%;
            margin: 0 auto;
        }

        /* Make chart more readable */
        .chart-legend {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            margin-right: 5px;
        }

        /* Improve spacing for all section containers */
        .dashboard-section-container {
            margin-bottom: 25px;
        }

        /* Fix stat cards to be more minimal */
        .stat-card {
            padding: 15px;
            display: flex;
            align-items: center;
        }

        .stat-card i {
            font-size: 2rem;
            margin-right: 15px;
            color: #4CAF50;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 5px 0 0 0;
        }

        /* Ensure visibility for activity list items */
        .activity-item {
            background: #333;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
        }

        .task-status-chart {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            height: 320px;
        }
        
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
        
        .dashboard-card {
            background-color: #fff;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .dashboard-card h3 {
            margin-top: 0;
            color: #333;
            font-size: 1.2rem;
        }
        
        #dashboard-date-time {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        #refresh-dashboard {
            padding: 8px 16px;
            background-color: #4A6FFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
            margin-bottom: 20px;
        }
        
        #refresh-dashboard:hover {
            background-color: #3a5ad9;
        }

        /* Document card styles for onboarding review */
        .document-card {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .document-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .document-card .card-body {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .document-actions {
            margin-top: auto;
        }
        
        .border-warning {
            border-left: 3px solid #ffc107 !important;
        }
        
        .border-success {
            border-left: 3px solid #28a745 !important;
        }
        
        .border-danger {
            border-left: 3px solid #dc3545 !important;
        }
        
        .document-viewer-container {
            min-height: 400px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .documents-container {
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="branding">
        <button id="menu-toggle" class="menu-toggle">
            <i class="fas fa-bars"></i>
        </button>
        <h1 class="brand-name">
            <i class="fas fa-users-gear"></i>
            Onboard-X
        </h1>
        <div class="user-menu">
            <button class="user-menu-toggle">
                <i class="fas fa-user-circle"></i>
            </button>
        </div>
    </div>

    <div class="admin-dashboard">
        <div class="sidebar">
            <nav>
                <div class="nav-group">
                    <h3>Overview</h3>
                    <a href="#dashboard" class="active">
                        <i class="fas fa-chart-line"></i>
                        Dashboard
                    </a>
                </div>

                <div class="nav-group">
                    <h3>Employees</h3>
                    <a href="#employees">
                        <i class="fas fa-users"></i>
                        Employee List
                    </a>
                    <a href="#onboarding">
                        <i class="fas fa-user-plus"></i>
                        Onboarding
                    </a>
                    <a href="#offboarding">
                        <i class="fas fa-user-minus"></i>
                        Offboarding
                    </a>
                </div>

                <div class="nav-group">
                    <h3>Workflow</h3>
                    <a href="#tasks">
                        <i class="fas fa-tasks"></i>
                        Tasks
                    </a>
                    <a href="#templates">
                        <i class="fas fa-file-invoice"></i>
                        Templates
                    </a>
                </div>

                <div class="nav-group">
                    <h3>Settings</h3>
                    <a href="#notifications">
                        <i class="fas fa-bell"></i>
                        Notifications
                    </a>
                    <a href="#settings">
                        <i class="fas fa-cog"></i>
                        System Settings
                    </a>
                    <a href="#" id="logout-link">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </a>
                </div>
            </nav>
        </div>

        <div class="main-content">
            <!-- Dashboard Overview -->
            <section id="dashboard" class="dashboard-section">
                <div class="dashboard-header">
                    <h2>Welcome <span id="user-name">to your dashboard!</span></h2>
                    <div class="date-time">
                        <span id="current-date"></span>
                        <span id="current-time"></span>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-user-plus"></i>
                        <div class="stat-content">
                            <h3>Active Onboarding</h3>
                            <p class="stat-number" id="active-onboarding-count">-</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-tasks"></i>
                        <div class="stat-content">
                            <h3>Pending Tasks</h3>
                            <p class="stat-number" id="pending-tasks-count">-</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check-circle"></i>
                        <div class="stat-content">
                            <h3>Completed Tasks</h3>
                            <p class="stat-number" id="completed-tasks-count">-</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <div class="stat-content">
                            <h3>Total Employees</h3>
                            <p class="stat-number" id="total-employees-count">-</p>
                        </div>
                    </div>
                </div>

                <!-- Task Status Chart -->
                <div class="dashboard-section-container">
                    <div class="section-header">
                        <h3>Task Status Overview</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="taskStatusChart" height="250"></canvas>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="dashboard-section-container">
                    <div class="section-header">
                        <h3>Recent Activity</h3>
                        <a href="#notifications" class="view-all-link">View All</a>
                    </div>
                    <div class="activity-list" id="activity-list">
                        <!-- Activity items will be loaded dynamically -->
                        <div class="loading-indicator">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Loading recent activities...</p>
                        </div>
                    </div>
                </div>

                <!-- Recent Onboarding -->
                <div class="dashboard-section-container">
                    <div class="section-header">
                        <h3>Recent Onboarding</h3>
                        <a href="#onboarding" class="view-all-link">View All</a>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Department</th>
                                    <th>Start Date</th>
                                    <th>Progress</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recent-onboarding-list">
                                <!-- Recent onboarding entries will be loaded dynamically -->
                                <tr>
                                    <td colspan="5" class="text-center">
                                        <div class="loading-indicator">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            <p>Loading recent onboarding data...</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Employee List Section -->
            <section id="employees" class="dashboard-section">
                <div class="dashboard-header">
                    <h2>Employee Management</h2>
                    <div class="action-bar">
                        <input type="search" placeholder="Search employees...">
                        <button class="add-btn"><i class="fas fa-plus"></i> Add Employee</button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Department</th>
                                <th>Position</th>
                                <th>Start Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Sarah Johnson</td>
                                <td>Marketing</td>
                                <td>Content Manager</td>
                                <td>2024-03-15</td>
                                <td><span class="status-badge onboarding">Onboarding</span></td>
                                <td>
                                    <button class="action-btn"><i class="fas fa-edit"></i></button>
                                    <button class="action-btn"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>Michael Chen</td>
                                <td>Engineering</td>
                                <td>Senior Developer</td>
                                <td>2024-03-10</td>
                                <td><span class="status-badge active">Active</span></td>
                                <td>
                                    <button class="action-btn"><i class="fas fa-edit"></i></button>
                                    <button class="action-btn"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>Emily Brown</td>
                                <td>Sales</td>
                                <td>Account Executive</td>
                                <td>2024-03-01</td>
                                <td><span class="status-badge offboarding">Offboarding</span></td>
                                <td>
                                    <button class="action-btn"><i class="fas fa-edit"></i></button>
                                    <button class="action-btn"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Onboarding Section -->
            <section id="onboarding" class="dashboard-section">
                <div class="dashboard-header">
                    <h2>Onboarding Tracker</h2>
                    <button class="add-btn"><i class="fas fa-plus"></i> New Onboarding</button>
                </div>
                <div class="kanban-board">
                    <div class="kanban-column">
                        <h3>To Start</h3>
                        <div class="kanban-items" id="toStart">
                            <div class="loading-spinner"></div>
                            <p>Loading employees...</p>
                        </div>
                    </div>
                    <div class="kanban-column">
                        <h3>In Progress</h3>
                        <div class="kanban-items" id="inProgress">
                            <div class="loading-spinner"></div>
                            <p>Loading employees...</p>
                        </div>
                    </div>
                    <div class="kanban-column">
                        <h3>Completed</h3>
                        <!-- Debug button - Remove in production -->
                        <button id="test-onboarding-modal-btn" class="debug-button" style="margin-bottom: 10px; padding: 5px 10px; background-color: #6c5ce7; color: white; border: none; border-radius: 4px; cursor: pointer;" onclick="debugShowOnboardingModal()">Test Modal</button>
                        <div class="kanban-items" id="completed">
                            <div class="loading-spinner"></div>
                            <p>Loading employees...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Task Management Section -->
            <section id="tasks" class="dashboard-section">
                <div class="section-header">
                    <h2>Task Management</h2>
                    <div class="search-add">
                        <input type="text" id="task-search" placeholder="Search tasks...">
                        <button id="add-task-btn" class="btn-primary">
                            <i class="fas fa-plus"></i> Add Task
                        </button>
                    </div>
                </div>

                <div class="task-board">
                    <div class="task-column" id="todo-column">
                        <h3>To Do <span class="task-count">0</span></h3>
                        <div class="task-list" data-status="todo"></div>
                    </div>

                    <div class="task-column" id="in-progress-column">
                        <h3>In Progress <span class="task-count">0</span></h3>
                        <div class="task-list" data-status="in-progress"></div>
                    </div>

                    <div class="task-column" id="completed-column">
                        <h3>Completed <span class="task-count">0</span></h3>
                        <div class="task-list" data-status="completed"></div>
                    </div>
                </div>

                <!-- Add Task Modal -->
                <div id="add-task-modal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add New Task</h3>
                            <button class="close-modal">&times;</button>
                        </div>
                        <form id="add-task-form">
                            <div class="form-group">
                                <label for="task-title">Title</label>
                                <input type="text" id="task-title" required>
                            </div>
                            <div class="form-group">
                                <label for="task-description">Description</label>
                                <textarea id="task-description" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="task-assignee">Assign To</label>
                                <select id="task-assignee" required></select>
                            </div>
                            <div class="form-group">
                                <label for="task-due-date">Due Date</label>
                                <input type="date" id="task-due-date" required>
                            </div>
                            <div class="form-group">
                                <label for="task-priority">Priority</label>
                                <select id="task-priority" required>
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn-secondary close-modal">Cancel</button>
                                <button type="submit" class="btn-primary">Create Task</button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Templates Section -->
            <section id="templates" class="dashboard-section">
                <div class="dashboard-header">
                    <h2>Document Templates</h2>
                    <div class="action-bar">
                        <input type="search" placeholder="Search templates..." id="template-search">
                        <select class="template-filter" id="template-category-filter">
                            <option value="all">All Categories</option>
                            <option value="onboarding">Onboarding</option>
                            <option value="hr">HR Documents</option>
                            <option value="legal">Legal</option>
                            <option value="training">Training</option>
                            <option value="compliance">Compliance</option>
                        </select>
                        <button class="add-btn new-template-btn" id="new-template-btn"><i class="fas fa-plus"></i> New Template</button>
                    </div>
                </div>
                <div class="template-grid">
                    <div class="template-category">
                        <h3>Onboarding Templates</h3>
                        <div id="onboarding-templates" class="template-list">
                            <!-- Template items will be loaded dynamically -->
                            <div class="loading-indicator">
                                <i class="fas fa-spinner fa-spin"></i> Loading templates...
                            </div>
                        </div>
                    </div>
                    
                    <div class="template-category">
                        <h3>HR Documents</h3>
                        <div id="hr-documents" class="template-list">
                            <!-- Template items will be loaded dynamically -->
                            <div class="loading-indicator">
                                <i class="fas fa-spinner fa-spin"></i> Loading templates...
                            </div>
                        </div>
                    </div>
                    
                    <div class="template-category">
                        <h3>Legal Documents</h3>
                        <div id="legal-documents" class="template-list">
                            <!-- Template items will be loaded dynamically -->
                            <div class="loading-indicator">
                                <i class="fas fa-spinner fa-spin"></i> Loading templates...
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Notifications Section -->
            <section id="notifications" class="dashboard-section">
                <div class="dashboard-header">
                    <h2>Notification Center</h2>
                    <div class="action-bar">
                        <button class="filter-btn active">All</button>
                        <button class="filter-btn">Unread</button>
                        <button class="filter-btn">Important</button>
                    </div>
                </div>
                <div class="notification-list" id="notificationList">
                    <!-- Notifications will be dynamically populated -->
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="dashboard-section">
                <div class="dashboard-header">
                <h2>System Settings</h2>
                    <button class="add-btn"><i class="fas fa-save"></i> Save Changes</button>
                </div>
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3><i class="fas fa-building"></i> Basic Settings</h3>
                        <form class="settings-form">
                            <div class="form-group">
                                <label>Company Name</label>
                                <input type="text" value="OnboardX">
                            </div>
                            <div class="form-group">
                                <label>Logo</label>
                                <div class="file-upload">
                                    <input type="file" accept="image/*">
                                    <button type="button" class="upload-btn">Upload Logo</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Time Zone</label>
                                <select>
                                    <option>Pacific Time (PT)</option>
                                    <option>Eastern Time (ET)</option>
                                    <option>Central Time (CT)</option>
                                    <option>Mountain Time (MT)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Date Format</label>
                                <select>
                                    <option>MM/DD/YYYY</option>
                                    <option>DD/MM/YYYY</option>
                                    <option>YYYY-MM-DD</option>
                                </select>
                            </div>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-shield-alt"></i> Security</h3>
                        <form class="settings-form">
                            <div class="form-group">
                                <label>Password Requirements</label>
                                <select>
                                    <option>Strong (8+ chars, special chars)</option>
                                    <option>Basic (6+ chars)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Two-Factor Authentication</label>
                                <label class="switch">
                                    <input type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>Session Timeout</label>
                                <select>
                                    <option>30 minutes</option>
                                    <option>1 hour</option>
                                    <option>2 hours</option>
                                </select>
                            </div>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-users"></i> User Roles</h3>
                        <div class="role-list">
                            <div class="role-item">
                                <div class="role-info">
                                    <h4>Admin</h4>
                                    <p>Full system access</p>
                                </div>
                                <button class="action-btn"><i class="fas fa-edit"></i></button>
                            </div>
                            <div class="role-item">
                                <div class="role-info">
                                    <h4>HR Manager</h4>
                                    <p>Employee management access</p>
                                </div>
                                <button class="action-btn"><i class="fas fa-edit"></i></button>
                            </div>
                            <div class="role-item">
                                <div class="role-info">
                                    <h4>Team Leader</h4>
                                    <p>Basic team access</p>
                                </div>
                                <button class="action-btn"><i class="fas fa-edit"></i></button>
                            </div>
                        </div>
                        <button class="add-btn mt-3"><i class="fas fa-plus"></i> Add Role</button>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-bell"></i> Notifications</h3>
                        <form class="settings-form">
                            <div class="form-group">
                                <label>Email Notifications</label>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>Task Reminders</label>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>System Updates</label>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Offboarding Section -->
            <section id="offboarding" class="dashboard-section">
                <div class="dashboard-header">
                    <h2>Offboarding Management</h2>
                    <div class="action-bar">
                        <input type="search" placeholder="Search employees...">
                        <button class="add-btn"><i class="fas fa-plus"></i> New Offboarding</button>
                    </div>
                </div>
                <div class="offboarding-grid">
                    <div class="process-tracker">
                        <div class="kanban-board">
                            <div class="kanban-column">
                                <h3>Initiated</h3>
                                <div class="kanban-items">
                                    <div class="kanban-item">
                                        <h4>Emily Brown</h4>
                                        <p>Sales Executive</p>
                                        <span class="date">Last Day: Apr 15</span>
                                        <div class="checklist">
                                            <div class="checklist-item completed">
                                                <i class="fas fa-check"></i>
                                                <span>Exit Interview Scheduled</span>
                                            </div>
                                            <div class="checklist-item">
                                                <i class="fas fa-clock"></i>
                                                <span>Asset Return</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="kanban-column">
                                <h3>In Progress</h3>
                                <div class="kanban-items">
                                    <div class="kanban-item">
                                        <h4>John Smith</h4>
                                        <p>IT Specialist</p>
                                        <span class="date">Last Day: Apr 1</span>
                                        <div class="checklist">
                                            <div class="checklist-item completed">
                                                <i class="fas fa-check"></i>
                                                <span>Knowledge Transfer</span>
                                            </div>
                                            <div class="checklist-item completed">
                                                <i class="fas fa-check"></i>
                                                <span>System Access Review</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="kanban-column">
                                <h3>Completed</h3>
                                <div class="kanban-items">
                                    <div class="kanban-item">
                                        <h4>Lisa Anderson</h4>
                                        <p>HR Manager</p>
                                        <span class="date">Completed: Mar 30</span>
                                        <div class="task-progress">
                                            <div class="progress-bar" style="width: 100%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="offboarding-checklist">
                        <h3>Offboarding Checklist Template</h3>
                        <div class="checklist-categories">
                            <div class="checklist-category">
                                <h4><i class="fas fa-laptop"></i> IT & Systems</h4>
                                <ul>
                                    <li>Disable system access</li>
                                    <li>Collect company devices</li>
                                    <li>Data backup</li>
                                    <li>Remove from distribution lists</li>
                                </ul>
                            </div>
                            <div class="checklist-category">
                                <h4><i class="fas fa-file-alt"></i> Documentation</h4>
                                <ul>
                                    <li>Exit interview documentation</li>
                                    <li>Final payroll processing</li>
                                    <li>Benefits termination</li>
                                    <li>NDA review</li>
                                </ul>
                            </div>
                            <div class="checklist-category">
                                <h4><i class="fas fa-people-arrows"></i> Knowledge Transfer</h4>
                                <ul>
                                    <li>Project handover</li>
                                    <li>Document processes</li>
                                    <li>Team notification</li>
                                    <li>Client transition</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal for New Offboarding Process -->
    <div id="new-offboarding-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Start New Offboarding Process</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="new-offboarding-form">
                    <div class="form-group">
                        <label for="employeeId">Employee</label>
                        <select name="employeeId" id="employeeId" required>
                            <option value="">Select an employee</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="exitDate">Last Working Day</label>
                        <input type="date" name="exitDate" id="exitDate" required>
                    </div>
                    <div class="form-group">
                        <label for="reason">Reason for Offboarding</label>
                        <select name="reason" id="reason" required>
                            <option value="">Select a reason</option>
                            <option value="resignation">Resignation</option>
                            <option value="termination">Termination</option>
                            <option value="retirement">Retirement</option>
                            <option value="relocation">Relocation</option>
                            <option value="new-opportunity">New Opportunity</option>
                            <option value="personal">Personal Reasons</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="notes">Notes</label>
                        <textarea name="notes" id="notes" rows="4" placeholder="Add any relevant notes about this offboarding process"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary close-modal">Cancel</button>
                        <button type="submit" class="btn-primary">Create Offboarding Process</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal for Offboarding Process Details -->
    <div id="offboarding-details-modal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 class="modal-title">Offboarding: Employee Name</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="offboarding-details-grid">
                    <div class="offboarding-details-section">
                        <h4>Employee Information</h4>
                        <div class="employee-info">
                            <!-- Employee info will be inserted here -->
                        </div>
                    </div>
                    <div class="offboarding-details-section">
                        <h4>Process Information</h4>
                        <div class="process-info">
                            <!-- Process info will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <div class="offboarding-details-section mt-4">
                    <h4>Tasks</h4>
                    <div class="tasks-list">
                        <!-- Tasks will be inserted here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <!-- Action buttons will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Onboarding Approval Modal -->
    <div id="onboarding-approval-modal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 class="modal-title">Onboarding Submission: <span id="employee-name"></span></h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="submission-info-bar">
                    <div class="submission-meta">
                        <span class="meta-label">Submitted:</span>
                        <span id="submission-date"></span>
                    </div>
                    <div class="submission-meta">
                        <span class="meta-label">Status:</span>
                        <span id="submission-status" class="status-badge"></span>
                    </div>
                </div>

                <div id="missing-items-section" style="display: none;" class="alert-box warning">
                    <h4><i class="fas fa-exclamation-triangle"></i> Missing Items</h4>
                    <ul id="missing-items-list"></ul>
                </div>

                <div class="tabs-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="personal-info-tab">Personal Information</button>
                        <button class="tab-btn" data-tab="employment-tab">Employment Details</button>
                        <button class="tab-btn" data-tab="documents-tab">Documents</button>
                        <button class="tab-btn" data-tab="approval-tab">Approval</button>
                    </div>

                    <div id="personal-info-tab" class="tab-content" data-tab="personal-info-tab">
                        <div class="info-grid">
                            <div class="info-section">
                                <h4>Basic Information</h4>
                                <div class="info-row">
                                    <span class="info-label">Full Name:</span>
                                    <span id="info-fullname" class="info-value"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Date of Birth:</span>
                                    <span id="info-dob" class="info-value"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Address:</span>
                                    <span id="info-address" class="info-value"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Phone:</span>
                                    <span id="info-phone" class="info-value"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Email:</span>
                                    <span id="info-email" class="info-value"></span>
                                </div>
                            </div>
                            <div class="info-section">
                                <h4>Emergency Contact</h4>
                                <div class="info-row">
                                    <span class="info-label">Name:</span>
                                    <span id="info-emergency-name" class="info-value"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Relationship:</span>
                                    <span id="info-emergency-relationship" class="info-value"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Phone:</span>
                                    <span id="info-emergency-phone" class="info-value"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="employment-tab" class="tab-content" data-tab="employment-tab">
                        <div class="info-grid">
                            <div class="info-section">
                                <h4>Position Details</h4>
                                <div class="info-row">
                                    <span class="info-label">Position:</span>
                                    <span id="info-position" class="info-value"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Department:</span>
                                    <span id="info-department" class="info-value"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Start Date:</span>
                                    <span id="info-start-date" class="info-value"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Work Schedule:</span>
                                    <span id="info-work-schedule" class="info-value"></span>
                                </div>
                            </div>
                            <div class="info-section">
                                <h4>Payment Information</h4>
                                <div class="info-row">
                                    <span class="info-label">Bank Name:</span>
                                    <span id="info-bank-name" class="info-value"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Account Number:</span>
                                    <span id="info-account-number" class="info-value"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Routing Number:</span>
                                    <span id="info-routing-number" class="info-value"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="documents-tab" class="tab-content" data-tab="documents-tab">
                        <div id="documents-container">
                            <div class="documents-header">
                                <h4>Submitted Documents</h4>
                            </div>
                            <div id="documents-list" class="documents-list">
                                <!-- Documents will be inserted here dynamically -->
                            </div>
                            <!-- Add document preview container -->
                            <div id="document-preview">
                                <div class="preview-placeholder">Select a document to preview</div>
                            </div>
                        </div>
                    </div>

                    <div id="approval-tab" class="tab-content" data-tab="approval-tab">
                        <div class="approval-section">
                            <h4>HR Review</h4>
                            <div class="form-group">
                                <label for="feedback-text">Feedback/Comments (required for revision requests)</label>
                                <textarea id="feedback-text" rows="4" placeholder="Provide feedback to the employee..."></textarea>
                            </div>
                            
                            <div class="missing-items-editor">
                                <h4>Mark Missing Items</h4>
                                <p>Check any items that need to be addressed:</p>
                                <div class="missing-items-checklist">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="missing-personal-info" value="Personal information incomplete">
                                        <label for="missing-personal-info">Personal information incomplete</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="missing-contact-info" value="Contact information missing or invalid">
                                        <label for="missing-contact-info">Contact information missing or invalid</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="missing-emergency-contact" value="Emergency contact incomplete">
                                        <label for="missing-emergency-contact">Emergency contact incomplete</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="missing-bank-info" value="Banking information incomplete">
                                        <label for="missing-bank-info">Banking information incomplete</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="missing-id-documents" value="ID documents missing">
                                        <label for="missing-id-documents">ID documents missing</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="missing-tax-forms" value="Tax forms incomplete or missing">
                                        <label for="missing-tax-forms">Tax forms incomplete or missing</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="missing-other-docs" value="Other required documents missing">
                                        <label for="missing-other-docs">Other required documents missing</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="custom-missing-item">Custom Missing Item</label>
                                    <div class="custom-missing-item-container">
                                        <input type="text" id="custom-missing-item" placeholder="Enter custom missing item...">
                                        <button type="button" id="add-custom-item" class="btn-secondary">Add</button>
                                    </div>
                                </div>
                                <div id="custom-missing-items-list">
                                    <!-- Custom missing items will be added here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="request-revisions-btn" class="btn-warning"><i class="fas fa-redo"></i> Request Revisions</button>
                <button id="approve-onboarding-btn" class="btn-success"><i class="fas fa-check"></i> Approve Submission</button>
                <button id="close-approval-modal" class="btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Document Preview Modal -->
    <div id="document-viewer-modal" class="modal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h3 class="modal-title">Document: <span id="document-name"></span></h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="document-container">
                    <!-- Document content will be displayed here -->
                </div>
            </div>
            <div class="modal-footer">
                <a id="download-document" class="btn-primary" href="#" download><i class="fas fa-download"></i> Download</a>
                <button class="btn-secondary close-modal">Close</button>
            </div>
        </div>
    </div>

    <script src="/js/admin.js" defer></script>
    <script>
        // Dashboard Data Loading
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial dashboard data
            loadDashboardData();
            
            // Add event listener for refresh button if it exists
            const refreshBtn = document.getElementById('refresh-dashboard');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    loadDashboardData();
                });
            }
            
            // Update date and time
            updateDateTime();
            // Set up interval for updating date and time
            setInterval(updateDateTime, 60000);
        });
        
        // Update date and time
        function updateDateTime() {
            const now = new Date();
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }
        
        // Fetch current user information
        async function fetchCurrentUser() {
            try {
                const response = await fetch('/api/auth/me');
                if (response.ok) {
                    const userData = await response.json();
                    document.getElementById('user-name').textContent = userData.name || 'Admin';
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        }
        
        // Create the task status chart
        function createTaskStatusChart(todo, inProgress, completed) {
            // Get the canvas element
            const ctx = document.getElementById('taskStatusChart').getContext('2d');
            
            // Check if a chart instance already exists and destroy it
            if (window.taskStatusChart) {
                window.taskStatusChart.destroy();
            }
            
            // Ensure values are numbers and set defaults if not provided
            todo = typeof todo === 'number' ? todo : 0;
            inProgress = typeof inProgress === 'number' ? inProgress : 0;
            completed = typeof completed === 'number' ? completed : 0;
            
            // Define vibrant colors with good contrast
            const chartColors = {
                todo: 'rgba(255, 99, 132, 0.9)',        // Bright pink
                inProgress: 'rgba(54, 162, 235, 0.9)',  // Bright blue
                completed: 'rgba(75, 192, 75, 0.9)',    // Bright green
            };
            
            // Create the chart
            window.taskStatusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['To Do', 'In Progress', 'Completed'],
                    datasets: [{
                        data: [todo, inProgress, completed],
                        backgroundColor: [
                            chartColors.todo,
                            chartColors.inProgress, 
                            chartColors.completed
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)', 
                            'rgba(75, 192, 75, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                boxWidth: 12,
                                color: '#333' // Darker color for better readability
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            padding: 12,
                            bodyFont: {
                                size: 14
                            },
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000
                    }
                }
            });
            
            // Update chart container background - fixed to have white background
            const chartContainer = document.querySelector('.task-status-chart');
            if (chartContainer) {
                chartContainer.style.backgroundColor = '#ffffff';
                chartContainer.style.borderRadius = '8px';
                chartContainer.style.padding = '15px';
                chartContainer.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
            }
            
            // Ensure the canvas itself has a white background
            const canvas = document.getElementById('taskStatusChart');
            if (canvas) {
                canvas.style.backgroundColor = '#ffffff';
            }
        }
        
        // Load dashboard data with proper authentication and error handling
        async function loadDashboardData() {
            try {
                // Show loading indicators
                document.getElementById('total-employees-count').textContent = '...';
                document.getElementById('active-onboarding-count').textContent = '...';
                document.getElementById('pending-tasks-count').textContent = '...';
                document.getElementById('completed-tasks-count').textContent = '...';
                
                // Get auth token
                const token = localStorage.getItem('token');
                if (!token) {
                    // Show login needed message
                    document.getElementById('total-employees-count').textContent = '-';
                    document.getElementById('active-onboarding-count').textContent = '-';
                    document.getElementById('pending-tasks-count').textContent = '-';
                    document.getElementById('completed-tasks-count').textContent = '-';
                    createTaskStatusChart(null, null, null); // Use sample data
                    return;
                }
                
                const headers = {
                    'Authorization': `Bearer ${token}`,
                    'Accept': 'application/json'
                };
                
                // Fetch tasks
                let taskTodo = 0;
                let taskInProgress = 0;
                let taskCompleted = 0;
                
                try {
                    const tasksResponse = await fetch('/api/tasks', { headers });
                    
                    if (tasksResponse.ok) {
                        const tasks = await tasksResponse.json();
                        
                        if (Array.isArray(tasks)) {
                            // Count tasks by status
                            taskTodo = tasks.filter(task => task.status === 'todo').length;
                            taskInProgress = tasks.filter(task => task.status === 'in-progress').length;
                            taskCompleted = tasks.filter(task => task.status === 'completed').length;
                            
                            // Update counts on dashboard
                            document.getElementById('pending-tasks-count').textContent = taskTodo + taskInProgress;
                            document.getElementById('completed-tasks-count').textContent = taskCompleted;
                            
                            // Update task count indicators on kanban board if they exist
                            const todoCount = document.querySelector('#todo-column .task-count');
                            const inProgressCount = document.querySelector('#in-progress-column .task-count');
                            const completedCount = document.querySelector('#completed-column .task-count');
                            
                            if (todoCount) todoCount.textContent = taskTodo;
                            if (inProgressCount) inProgressCount.textContent = taskInProgress;
                            if (completedCount) completedCount.textContent = taskCompleted;
                        }
                    }
                } catch (error) {
                    console.error('Error fetching tasks:', error);
                }
                
                // Create chart with real data or sample data if API failed
                createTaskStatusChart(taskTodo, taskInProgress, taskCompleted);
                
                // Fetch employees count
                try {
                    const employeesResponse = await fetch('/api/employees', { headers });
                    
                    if (employeesResponse.ok) {
                        const employees = await employeesResponse.json();
                        const count = Array.isArray(employees) ? employees.length : (employees.count || 0);
                        document.getElementById('total-employees-count').textContent = count;
                        
                        // Count onboarding employees
                        const onboardingCount = Array.isArray(employees) 
                            ? employees.filter(e => e.status === 'onboarding').length 
                            : 0;
                        document.getElementById('active-onboarding-count').textContent = onboardingCount;
                    }
                } catch (error) {
                    console.error('Error fetching employees:', error);
                    document.getElementById('total-employees-count').textContent = '-';
                    document.getElementById('active-onboarding-count').textContent = '-';
                }
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                createTaskStatusChart(null, null, null); // Use sample data on error
            }
        }
        
        // Load recent activities with proper error handling
        async function loadRecentActivities() {
            try {
                const activityList = document.getElementById('activity-list');
                if (!activityList) return; // Skip if element doesn't exist
                
                const token = localStorage.getItem('token');
                if (!token) {
                    activityList.innerHTML = '<div class="empty-state">Please log in to view activities</div>';
                    return;
                }
                
                try {
                    const response = await fetch('/api/activities?limit=5', {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Failed to load activities: ${response.status}`);
                    }
                    
                    const contentType = response.headers.get('content-type');
                    if (!contentType || !contentType.includes('application/json')) {
                        throw new Error('Invalid response format');
                    }
                    
                    const activities = await response.json();
                    
                    if (activities.length === 0) {
                        activityList.innerHTML = '<div class="empty-state">No recent activities</div>';
                    } else {
                        activityList.innerHTML = '';
                        
                        activities.forEach(activity => {
                            const timeAgo = formatTimeAgo(new Date(activity.timestamp));
                            let iconClass = 'fa-bell';
                            
                            const activityItem = document.createElement('div');
                            activityItem.className = 'activity-item';
                            activityItem.innerHTML = `
                                <i class="fas ${iconClass}"></i>
                                <div class="activity-content">
                                    <p>${activity.description || 'Activity recorded'}</p>
                                    <span class="activity-time">${timeAgo}</span>
                                </div>
                            `;
                            
                            activityList.appendChild(activityItem);
                        });
                    }
                } catch (error) {
                    console.error('Error loading activities:', error);
                    activityList.innerHTML = '<div class="error-state">Could not load activities</div>';
                    
                    // Add sample activities as fallback
                    setTimeout(() => {
                        if (activityList.querySelector('.error-state')) {
                            activityList.innerHTML = '';
                            
                            const sampleActivities = [
                                { icon: 'fa-user-plus', text: 'New employee Sarah Johnson started onboarding process', time: '2 hours ago' },
                                { icon: 'fa-file-alt', text: 'Employment contract for Michael Chen approved', time: '3 hours ago' },
                                { icon: 'fa-laptop', text: 'IT setup completed for David Wilson', time: '5 hours ago' },
                                { icon: 'fa-calendar-check', text: 'Orientation scheduled for new Marketing team', time: 'Yesterday' }
                            ];
                            
                            sampleActivities.forEach(activity => {
                                const activityItem = document.createElement('div');
                                activityItem.className = 'activity-item';
                                activityItem.innerHTML = `
                                    <i class="fas ${activity.icon}"></i>
                                    <div class="activity-content">
                                        <p>${activity.text}</p>
                                        <span class="activity-time">${activity.time}</span>
                                    </div>
                                `;
                                
                                activityList.appendChild(activityItem);
                            });
                        }
                    }, 500);
                }
            } catch (error) {
                console.error('Error in loadRecentActivities:', error);
            }
        }
        
        // Load recent onboarding with proper error handling
        async function loadRecentOnboarding() {
            try {
                const onboardingList = document.getElementById('recent-onboarding-list');
                if (!onboardingList) return; // Skip if element doesn't exist
                
                const token = localStorage.getItem('token');
                if (!token) {
                    onboardingList.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">Please log in to view onboarding data</td>
                        </tr>
                    `;
                    return;
                }
                
                try {
                    const response = await fetch('/api/employees?status=onboarding&limit=5', {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Failed to load onboarding data: ${response.status}`);
                    }
                    
                    const contentType = response.headers.get('content-type');
                    if (!contentType || !contentType.includes('application/json')) {
                        throw new Error('Invalid response format');
                    }
                    
                    const onboardingData = await response.json();
                    const employees = onboardingData.employees || onboardingData;
                    
                    if (!employees || employees.length === 0) {
                        onboardingList.innerHTML = `
                            <tr>
                                <td colspan="5" class="text-center">No active onboarding processes</td>
                            </tr>
                        `;
                    } else {
                        onboardingList.innerHTML = '';
                        
                        employees.slice(0, 5).forEach(employee => {
                            const progress = employee.onboarding ? 
                                Math.round((employee.onboarding.completedSteps / employee.onboarding.totalSteps) * 100) : 0;
                            
                            const startDate = employee.startDate ? 
                                new Date(employee.startDate).toLocaleDateString() : 'N/A';
                            
                            const status = employee.status || 'pending';
                            
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${employee.name || 'New Employee'}</td>
                                <td>${employee.department || 'N/A'}</td>
                                <td>${startDate}</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress" style="width: ${progress}%"></div>
                                    </div>
                                    <span class="progress-text">${progress}%</span>
                                </td>
                                <td><span class="status-badge ${getStatusClass(status)}">${status}</span></td>
                            `;
                            
                            onboardingList.appendChild(row);
                        });
                    }
                } catch (error) {
                    console.error('Error loading onboarding data:', error);
                    onboardingList.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">Could not load onboarding data</td>
                        </tr>
                    `;
                    
                    // Add sample data as fallback
                    setTimeout(() => {
                        if (onboardingList.querySelector('td.text-center')) {
                            onboardingList.innerHTML = '';
                            
                            const sampleEmployees = [
                                { name: 'John Smith', department: 'Engineering', startDate: '2023-04-01', progress: 75, status: 'active' },
                                { name: 'Sarah Johnson', department: 'Marketing', startDate: '2023-04-05', progress: 40, status: 'active' },
                                { name: 'Michael Chen', department: 'Finance', startDate: '2023-04-10', progress: 20, status: 'active' }
                            ];
                            
                            sampleEmployees.forEach(employee => {
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td>${employee.name}</td>
                                    <td>${employee.department}</td>
                                    <td>${new Date(employee.startDate).toLocaleDateString()}</td>
                                    <td>
                                        <div class="progress-bar">
                                            <div class="progress" style="width: ${employee.progress}%"></div>
                                        </div>
                                        <span class="progress-text">${employee.progress}%</span>
                                    </td>
                                    <td><span class="status-badge ${getStatusClass(employee.status)}">${employee.status}</span></td>
                                `;
                                
                                onboardingList.appendChild(row);
                            });
                        }
                    }, 500);
                }
            } catch (error) {
                console.error('Error in loadRecentOnboarding:', error);
            }
        }
        
        // Calculate progress percentage
        function calculateProgress(completed, total) {
            if (!total || total === 0) return 0;
            return Math.round((completed / total) * 100);
        }
        
        // Get status badge class
        function getStatusClass(status) {
            switch (status.toLowerCase()) {
                case 'active': return 'active';
                case 'completed': return 'success';
                case 'delayed': return 'warning';
                case 'onhold': return 'secondary';
                default: return 'default';
            }
        }
        
        // Format time ago function if not already defined
        function formatTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) {
                return 'Just now';
            }
            
            const diffInMinutes = Math.floor(diffInSeconds / 60);
            if (diffInMinutes < 60) {
                return `${diffInMinutes} minute${diffInMinutes > 1 ? 's' : ''} ago`;
            }
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) {
                return `${diffInHours} hour${diffInHours > 1 ? 's' : ''} ago`;
            }
            
            const diffInDays = Math.floor(diffInHours / 24);
            if (diffInDays < 7) {
                return diffInDays === 1 ? 'Yesterday' : `${diffInDays} days ago`;
            }
            
            return date.toLocaleDateString();
        }
        
        // Task Management
        async function initializeTaskManagement() {
            // Load task management code
            // This can be the existing task management code or added later
        }
    </script>
</body>
</html>